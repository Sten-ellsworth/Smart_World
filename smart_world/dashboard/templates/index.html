{% extends 'base.html' %}
{% block content %}

<!-- Inladen van de inhoud van de static folder-->
{% load staticfiles %}

<!-- Overal het lettertype "Roboto toepassen"-->
<link href="http://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
 <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<!-- Logo met banner-->
<div class="row" align="center">
    <div class="col" style="background-image:url('{% static 'images/background_picture.png' %}');">
        <img src= "{% static 'images/wf2.png' %}" align="center" hspace="20"height="150" width="250" alt="Text to display if image is not found">
    </div>
</div>

<!-- 1ste row met:
- Weergave of de parkeergarage vol of vrij is
- Weergave hoeveel plekken er beschikbaar zijn
 -->
<div class="row">
    <div class="col-6 text-center">
            <div class="center border-right" style="margin-top: 30px;">
                <p style="font-size:20px;">Parkeergarage Windesheim Flevoland</p>
                <button id="vrij" type="button" class="btn btn-success" align="center"  style="padding: 10px 20px; font-size: 20px; border-radius: 10px; width:120px; {% if not empty_or_full_value %} display: none; {% endif %}"><b>Vrij</b></button>
                <button id="vol" type="button" class="btn btn-danger" align="center"  style="padding: 10px 20px; font-size: 20px; border-radius: 10px; width:120px; {% if empty_or_full_value %} display: none; {% endif %}"><b>Vol</b></button>
            </div>
    </div>
    <div class="col-6 text-center">
        <div class="bezet" style="margin-top: 30px; margin-right: 100px;">
            <p style="font-size:20px;">Plaatsen beschikbaar</p>
                {% for data in graphQuery%}
                {{data.sensorValue}}
                {%endfor%}
                <p style="font-size:200%"> {{graphQuery}}</p>
            <p style="font-size:27px;" id="sensorValues">{{empty_or_full_value.count}}/{{sensor.count}}</p>
        </div>
    </div>
</div>

<hr>
<!--Grafiek-->

<!-- 2de Row met gedeeltes:
Gedeelte 1:
- De grafiek
Gedeelte 2:
- De verwachte tijd dat de garage vol is.
- De zoek functie
-->
<div class="row">
    <div class="col-6 text-center">
        <div align="center">
            <div id="ParkeerGrafiek">
                <div class="chart-container" style="position: relative; height:10vh; width:45vw">
                    <canvas id="myChart"></canvas>
                    <script src="{% static 'node_modules/chart.js/dist/Chart.js' %}"></script>
                    <script>
                        var ctx = document.getElementById('myChart').getContext('2d');
                        var myChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: [{% for date in dates %}'{{ date.created_at }}',{%endfor %}
                                ],
                                datasets: [{
                                    label: 'Parkeerplekken vrij',
                                    data: [3, {% for date in dates %}'{{date.availability}}',{%endfor %},
                                ],
                                backgroundColor: [
                                    'rgba(255, 201, 4, 0.4)',
                                ],
                                borderColor : [
                                'rgba(255, 201, 4, 0.4)',
                                ],
                                borderWidth :
                                '1'
                                }]
                            },
                        options: {
                            defaultFontFamily: 'Roboto',
                            tooltips: {
                            legend: {
                            position: 'bottom',
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        beginAtZero: true,
                                        suggestedMin: 50,
                                        suggestedMax: 100
                                    }
                                }]
                            }
                            }
                            }
                            }
                            });
                            </script>
                        </div>
                    </div>
                </div>
            </div>

    <div class="col-6 text-center" style="margin-top: 70px;">
        <p style="font-size:20px;">De verwachte tijd dat parkeergarage vol is:<b> {% for prog in prognose %} {{prog.created_at|date:'H:i' }}{% endfor %}</b></p>
        <h6>De verwachte tijd dat parkeergarage vol is:<b> {% for prog1 in prognose1 %} {{prog1.created_at|date:'H:i' }}{% endfor %}</h6>
        <h6>De verwachte tijd dat parkeergarage vol is:<b> {% for prog2 in prognose2 %} {{prog2.created_at|date:'H:i' }}{% endfor %}</h6>
        <h6>De verwachte tijd dat parkeergarage vol is:<b> {% for prog3 in prognose3 %} {{prog3.created_at|date:'H:i' }}{% endfor %}</h6>
        <h6>De verwachte tijd dat parkeergarage vol is:<b> {% for prog4 in prog_avg %} {{prog4.created_at|date:'H:i' }}{% endfor %}</h6>
        <h6>De verwachte tijd dat parkeergarage vol is:<b> {% for prog5 in prog_avg_sum1 %} {{prog5.created_at|date:'H:i' }}{% endfor %}</h6>

    <div style="margin-top: 75px;">
        <form method="get" action="/">
            <p style="font-size:20px;">Specifieke dag zoeken
            <input type="date" name="date" data-date-inline-picker="true" required></p>
            <button class="btn btn-warning text-white" type="submit" style="padding: 10px 20px; font-size: 20px; border-radius: 10px; width:120px; margin-top: 30px;"><b>Zoeken</b></button>
        </form>
    </div>
    </div>
</div>
<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous">
</script>
<script>
    //check of javascript is ready to start
    $(document).ready(function() {
        setInterval(() => { // set interval each second
            $.get("/sensor", (sensors) => { //get api /sensor
                let count = 0; // empty_or_full_value.count
                for(let index in sensors) { //loop
                    if(sensors[index].sensorValue === 1) count++; //is sensorValue = 1 ++
                }
                let output = `${count}/${sensors.length}`; //html format
                $("#sensorValues").html(output); //write html

                if(count === 0) {
                    $("#vrij").hide();
                    $("#vol").show();
                } else {
                    $("#vrij").show();
                    $("#vol").hide();
                }
            });
        }, 10000);
    });
</script>


{% endblock %}